from flask import Flask, render_template, request
import nltk
from nltk.tokenize import sent_tokenize, word_tokenize
from nltk.corpus import stopwords
from string import punctuation
import heapq

nltk.download('punkt')
nltk.download('stopwords')

app = Flask(__name__)

def summarize_text(text, num_sentences=3):
    sentences = sent_tokenize(text)
    words = word_tokenize(text.lower())

    stop_words = set(stopwords.words("english"))
    freq = {}

    for word in words:
        if word not in stop_words and word not in punctuation:
            freq[word] = freq.get(word, 0) + 1

    sentence_scores = {}
    for sent in sentences:
        for word in word_tokenize(sent.lower()):
            if word in freq:
                sentence_scores[sent] = sentence_scores.get(sent, 0) + freq[word]

    summary_sentences = heapq.nlargest(num_sentences, sentence_scores, key=sentence_scores.get)
    summary = " ".join(summary_sentences)
    return summary


@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == "POST":
        text = request.form["text"]
        if len(text.strip()) == 0:
            return render_template("index.html", error="Please enter some text.")

        summary = summarize_text(text)
        return render_template("result.html", original=text, summary=summary)

    return render_template("index.html")


if __name__ == "__main__":
    app.run(debug=True)
